/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={500:(e,a)=>{var t;!function(){"use strict";var s={}.hasOwnProperty;function n(){for(var e="",a=0;a<arguments.length;a++){var t=arguments[a];t&&(e=o(e,l(t)))}return e}function l(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var a="";for(var t in e)s.call(e,t)&&e[t]&&(a=o(a,t));return a}function o(e,a){return a?e?e+" "+a:e+a:e}e.exports?(n.default=n,e.exports=n):void 0===(t=function(){return n}.apply(a,[]))||(e.exports=t)}()}},a={};function t(s){var n=a[s];if(void 0!==n)return n.exports;var l=a[s]={exports:{}};return e[s](l,l.exports,t),l.exports}t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{"use strict";const e=window.wp.element,a=window.aicp.helpers,s=window.aicp.components,n=window.wp.i18n,l=window.aicp["api-assistants"],o=[{title:(0,n.__)("Complete","ai-copilot"),name:"completion"},{title:(0,n.__)("Chat","ai-copilot"),name:"chat"},{title:(0,e.createElement)(e.Fragment,null,(0,n.__)("Assistant","ai-copilot"),(0,e.createElement)(s.Badge,null,"Beta")),name:"assistant"},{title:(0,n.__)("Image","ai-copilot"),name:"image"}],r=(0,e.createContext)({}),i=()=>(0,e.useContext)(r),c=(e,t)=>{var s;switch(t.type){case"SET_IS_MODAL_OPEN":return{...e,isModalOpen:t.payload};case"SET_PLAYGROUND_TAB":return{...e,playgroundTab:t.payload};case"SET_PLAYGROUND_ERROR":{const a=t.payload?t.payload:(0,n.__)("An unexpected error occurred","ai-copilot");return{...e,playgroundErrorMessage:a}}case"SET_PLAYGROUND_COMPLETION":return(0,a.deepMerge)(e,{playgroundCompletion:t.payload});case"SET_PLAYGROUND_CHAT":return(0,a.deepMerge)(e,{playgroundChat:t.payload});case"SET_PLAYGROUND_RESPONSE_ERROR":return(0,a.deepMerge)(e,{responseError:t.payload});case"SET_PLAYGROUND_IMAGE":return(0,a.deepMerge)(e,{playgroundImage:t.payload});case"SET_ASSISTANT_CONVERSATION_ID":return t.payload||0===t.payload?(0,a.deepMerge)(e,{playgroundAssistant:{assistantId:t.payload.toString()}}):(0,a.deepMerge)(e,{playgroundAssistant:{assistantId:null}});case"SET_ASSISTANT_INSTANCES":{const s=e.playgroundAssistant.assistantsConversations;return(0,a.deepMerge)(e,{playgroundAssistant:{assistantsConversations:t.payload.reduce(((e,a)=>(e[a.assistant_id]||(e[a.assistant_id]={messageListArray:[],threadOpenaiId:""}),e)),s)}})}case"SET_ASSISTANT_CONVERSATION_MESSAGE":const l=[...null!==(s=e.playgroundAssistant.assistantsConversations[e.playgroundAssistant.assistantId].messageListArray)&&void 0!==s?s:[],{...t.payload}];return(0,a.deepMerge)(e,{playgroundAssistant:{assistantsConversations:{[e.playgroundAssistant.assistantId]:{messageListArray:l}}}});case"SET_ASSISTANT_CONVERSATION_THREAD_OPENAI_ID":return(0,a.deepMerge)(e,{playgroundAssistant:{assistantsConversations:{[e.playgroundAssistant.assistantId]:{threadOpenaiId:t.payload}}}})}return e},m=({children:t})=>{const{assistants:s,createAssistant:n,deleteAssistant:i,editAssistant:m}=(0,l.useApiAssistant)(),[d,_]=(0,e.useReducer)(c,{isModalOpen:!1,playgroundTab:"chat",responseError:"",playgroundCompletion:{model:"gpt-3.5-turbo-instruct",model_temperature:1,model_max_tokens:256,model_top_p:1,model_frequency_penalty:0,model_presence_penalty:0,model_stop:"",model_best_of:1,prompt:""},playgroundChat:{model:"gpt-3.5-turbo",model_temperature:1,model_max_tokens:256,model_top_p:1,model_frequency_penalty:0,model_presence_penalty:0,model_stop:"",messages:[]},playgroundAssistant:{assistantId:null,assistantsConversations:{}},playgroundImage:{...a.DEFAULT_CONFIG_IMAGE,images:[]}});return(0,e.createElement)(r.Provider,{value:{...d,TABS:o,setIsModalOpen:e=>{_({type:"SET_IS_MODAL_OPEN",payload:e})},setPlaygroundCompletion:e=>{_({type:"SET_PLAYGROUND_COMPLETION",payload:e})},setPlaygroundChat:e=>{_({type:"SET_PLAYGROUND_CHAT",payload:e})},setResponseError:e=>{_({type:"SET_PLAYGROUND_RESPONSE_ERROR",payload:e})},setAssistantsConversationId:e=>{_({type:"SET_ASSISTANT_CONVERSATION_ID",payload:e})},setAssistantConversationMessage:e=>{_({type:"SET_ASSISTANT_CONVERSATION_MESSAGE",payload:e})},setAssistantConversationThreadOpenaiId:e=>{_({type:"SET_ASSISTANT_CONVERSATION_THREAD_OPENAI_ID",payload:e})},setPlaygroundImage:e=>{_({type:"SET_PLAYGROUND_IMAGE",payload:e})},setPlaygroundTab:e=>{_({type:"SET_PLAYGROUND_TAB",payload:e})},createAssistant:n,deleteAssistant:i,editAssistant:m}},t)},d=(r.Consumer,window.aicp["api-admin-menu"]);var _=t(500),p=t.n(_);window.lodash;const u=window.wp.components,g=window.aicp["api-assistant-threads"],E=window.aicp["api-assistant-messages"];function y(){const{Fill:a}=(0,s.useModalSlotContext)(),{playgroundTab:t,setPlaygroundTab:l,TABS:o}=i(),r=e=>a=>{a.preventDefault(),l(e)};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.Header,null,(0,e.createElement)("h1",null,(0,n.__)("Playground","ai-copilot"))),(0,e.createElement)(a.Navigation,null,o.map((a=>{const{name:s,title:n}=a;return(0,e.createElement)("a",{key:s,href:"#",className:p()("media-menu-item",t===s&&"active"),onClick:r(s)},n)}))))}function S({children:a,className:t}){const{Fill:n}=(0,s.useModalSlotContext)();return(0,e.createElement)(n.Sidebar,null,(0,e.createElement)(u.Panel,{className:t},a))}const A=({isLoading:a,handleSubmit:t,isDisabled:l,children:o})=>{const{Fill:r}=(0,s.useModalSlotContext)();return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r.FooterLeft,null,(0,e.createElement)(e.Fragment,null,(0,e.createElement)("form",{className:"aicp__playground__modal-footer",onSubmit:t},(0,e.createElement)("div",{className:"aicp__playground__modal-footer__button-container"},(0,e.createElement)("button",{type:"submit",className:"button button-primary aicp__playground__modal-footer__submit",disabled:a||l},(0,n.__)("Submit","ai-copilot")),a&&(0,e.createElement)(s.Spinner,null))),o)),(0,e.createElement)(r.FooterRight,null,(0,e.createElement)(s.TransactionsFormTable,null)))},v=()=>{var a;const{playgroundAssistant:t}=i(),{assistantId:s,assistantsConversations:o}=t,{assistants:r}=(0,l.useApiAssistant)(),c=null!==(a=r?.[s])&&void 0!==a?a:r[0];return(0,e.createElement)("div",{className:"aicp__playground__modal-message-list"},o[c?.assistant_id]?.messageListArray?.map(((a,t)=>(0,e.createElement)("div",{key:t,className:"aicp__playground__modal-message-list__message"},(0,e.createElement)("h4",null,(0,e.createElement)("span",{className:"aicp__playground__modal-message-list__role-text"},"user"==a.role?(0,n.__)("USER","ai-copilot"):c.assistant_label)),(0,e.createElement)("div",{className:"aicp__playground__modal-message-list__text-input-focus"},(0,e.createElement)("p",null,a.content))))))},h=()=>{var t;const{Fill:o}=(0,s.useModalSlotContext)(),{playgroundAssistant:r,setResponseError:c,setAssistantConversationMessage:m,setAssistantsConversationId:d,setAssistantConversationThreadOpenaiId:_}=i(),{assistantId:p}=r,{assistants:h,editAssistant:f}=(0,l.useApiAssistant)(),T=null!==(t=h?.[p])&&void 0!==t?t:h[0],[C,N]=(0,e.useState)({...T}),[b,O]=(0,e.useState)({...T}),I=!(0,a.isObjectsEqual)(T,C),x=(0,a.isObjectsEqual)(b,C),{setTransactionsForm:M}=(0,s.useTransactionsFormProvider)(),[P,w]=(0,e.useState)(!1),[R,L]=(0,e.useState)(""),F=r.assistantsConversations[p]?.threadOpenaiId,D=!T?.openai_id||!R,k=e=>{N((a=>({...a,...e})))};(0,e.useEffect)((()=>{!p&&h.length>0&&d(h[0].assistant_id),!F&&p&&(async()=>{w(!0);try{const e=await(0,g.fetchServicesAssistantThreadsOpenAi)({assistant_id:p,openai_id:T.openai_id});if(!e)return w(!1),void c((0,n.__)("There was an error with the assistant","ai-copilot"));_(e.openai_id),w(!1)}catch(e){w(!1),c((0,n.__)("An error occurred while fetching data","ai-copilot"))}})(),p&&O(h[p])}),[p,F]);const G=null!==C.assistant_id&&void 0!==C.assistant_id;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(y,null),(0,e.createElement)(o.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(u.TextareaControl,{key:"assistant",className:"aicp__playground__modal__textarea",label:(0,n.__)("Instructions","ai-copilot"),placeholder:(0,n.__)("You are a sales assistant inside a chat designed to help customers find products and services offered by QuadLayers.","ai-copilot"),value:C.prompt_system,onChange:e=>k({prompt_system:e}),disabled:!G})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)("div",null,(0,e.createElement)(v,null)),(0,e.createElement)("div",null,(0,e.createElement)(u.TextareaControl,{className:"aicp__playground__modal__textarea",label:(0,n.__)("Message","ai-copilot"),placeholder:(0,n.__)("Enter your messageâ€¦","ai-copilot"),value:R,onChange:e=>L(e),disabled:P}))))),(0,e.createElement)(S,{className:"aicp__playground__assistant-sidebar"},(0,e.createElement)(s.AssistantTemplateSearchPanel,{initialOpen:!0,values:T,onChange:e=>{N({...e}),d(e.assistant_id)}}),(0,e.createElement)(s.AssistantTemplatesPanel,{initialOpen:!0,values:C,isPlaygroundMode:!0,onChange:k}),(0,e.createElement)(s.AssistantModelPanel,{values:C,isPlaygroundMode:!0,onChange:k}),(0,e.createElement)(s.AssistantVectorStorePanel,{values:C,isPlaygroundMode:!0,onChange:k}),(0,e.createElement)("div",{className:"aicp__playground__assistant-sidebar__footer"},(0,e.createElement)("button",{className:"button button-primary",onClick:async()=>{if(!T)return;w(!0);const e=await f(C);e&&N(e),w(!1)},disabled:!I},(0,n.__)("Save","ai-copilot")),(0,e.createElement)("button",{className:"button button-secondary",onClick:async()=>{T&&N(b)},disabled:x},(0,n.__)("Reset","ai-copilot")))),(0,e.createElement)(A,{isLoading:P,isDisabled:D,handleSubmit:async e=>{e.preventDefault(),m({role:"user",content:R}),c(""),w(!0);const a=await(0,E.fetchServicesAssistantMessagesOpenAi)("create",{thread_openai_id:F,message_content:R,assistant_id:p,openai_id:T.openai_id});if(!a)return w(!1),void c((0,n.__)("Failed to create message","ai-copilot"));const{response:t,transaction:s}=a;M(s);const{openai_id:l}=t,o=await(0,E.fetchServicesAssistantMessagesOpenAi)("messages",{thread_openai_id:F,openai_id:l});if(!o)return w(!1),void c((0,n.__)("Failed to get message","ai-copilot"));const r=o[0].message;m({role:"assistant",content:r}),L(""),w(!1)}}))},f=window.aicp["api-services"],T=window.aicp.icons,C=()=>{const{playgroundChat:a,setPlaygroundChat:t}=i(),s=(0,e.useRef)([]),l=e=>{const a=e.current;a&&(a.style.height=`${a.scrollHeight}px`)};return(0,e.useEffect)((()=>{(async()=>{s.current.forEach((e=>{l(e)}))})()}),[a]),(0,e.createElement)("div",{className:"aicp__playground__modal-message"},a.messages.map(((o,r)=>"system"===o.role?null:(s.current[r]||(s.current[r]=(0,e.createRef)()),(0,e.createElement)("div",{key:r,className:"aicp__playground__modal-message__message"},(0,e.createElement)("h4",{onClick:()=>(e=>{const s=[...a.messages];s[e].role="user"===s[e].role?"assistant":"user",t({...a,messages:s})})(r)},(0,e.createElement)("span",{className:"aicp__playground__modal-message__role-text"},"user"==a.messages[r]?.role?(0,n.__)("USER","ai-copilot"):(0,n.__)("ASSISTANT","ai-copilot"))),(0,e.createElement)("div",{className:"aicp__playground__modal-message__text-input-focus"},(0,e.createElement)("textarea",{ref:s.current[r],rows:"1",tabIndex:"0",value:a.messages[r]?.content||"",onChange:e=>{((e,s)=>{const n=[...a.messages];n[s]?n[s].content=e:n.push({role:s%2==1?"USER":"ASSISTANT",content:e}),t({...a,messages:n})})(e.target.value,r),l(s.current[r])},placeholder:"user"==a.messages[r]?.role?(0,n.__)("Enter a user message here.","ai-copilot"):(0,n.__)("Enter an assistant message here.","ai-copilot")})),(0,e.createElement)("div",{className:"aicp__playground__modal-message__button-container",onClick:()=>(e=>{const s=[...a.messages];s.splice(e,1),t({...a,messages:s})})(r)},(0,e.createElement)(T.Remove,null)))))),(0,e.createElement)("div",{className:"aicp__playground__modal-message__message aicp__playground__modal-message__add-message",onClick:()=>{const e=a.messages.filter((e=>"system"!==e.role)),s=e.length%2==1?"assistant":"user";t({...a,messages:[...a.messages,{role:s,content:""}]})}},(0,e.createElement)(T.AddMore,null),(0,e.createElement)("h4",null,(0,e.createElement)("span",null,(0,n.__)("Add message","ai-copilot")))))},N=()=>{const{Fill:a}=(0,s.useModalSlotContext)(),{playgroundChat:t,setPlaygroundChat:l,setResponseError:o}=i(),{setTransactionsForm:r}=(0,s.useTransactionsFormProvider)(),[c,m]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(y,null),(0,e.createElement)(a.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(u.TextareaControl,{key:"chat",className:"aicp__playground__modal__textarea",label:(0,n.__)("System","ai-copilot"),placeholder:(0,n.__)("You are a helpful assistant.","ai-copilot"),value:t.messages.find((e=>"system"===e.role&&e.content))?.content,onChange:e=>(e=>{let a=[...t.messages];a=a.filter((e=>"system"!==e.role)),a.push({role:"system",content:e}),l({messages:a})})(e)})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)(C,null)))),(0,e.createElement)(S,null,(0,e.createElement)(s.ContentModelPanel,{initialOpen:!0,mode:"chat",values:t,onChange:l})),(0,e.createElement)(A,{isLoading:c,handleSubmit:async e=>{e.preventDefault(),m(!0);try{const{response:e,transaction:a}=await(0,f.fetchServicesTextOpenAi)({model:t.model,max_tokens:t.model_max_tokens,temperature:t.model_temperature,messages:t.messages,consumer_module:"playground"});if(m(!1),a&&r(a),!e)return!1;(e=>{l({messages:[...t.messages,{role:"assistant",content:e}]})})(e)}catch(e){o(e.message)}},isDisabled:!t.messages[0]?.content&&!t.messages[1]?.content}))},b=()=>{const{Fill:a}=(0,s.useModalSlotContext)(),{playgroundCompletion:t,setPlaygroundCompletion:l,setResponseError:o}=i(),{setTransactionsForm:r}=(0,s.useTransactionsFormProvider)(),[c,m]=(0,e.useState)(!1);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(y,null),(0,e.createElement)(a.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column0"},(0,e.createElement)(u.TextareaControl,{key:"completion",className:"aicp__playground__modal__textarea",placeholder:(0,n.__)("Write a tagline for an ice cream shop.","ai-copilot"),value:t.prompt,onChange:e=>(e=>{l({prompt:e})})(e)})))),(0,e.createElement)(S,null,(0,e.createElement)(s.ContentModelPanel,{initialOpen:!0,mode:"completion",values:t,onChange:l})),(0,e.createElement)(A,{isLoading:c,handleSubmit:async e=>{e.preventDefault(),m(!0);try{const{response:e,transaction:a}=await(0,f.fetchServicesTextOpenAi)({model:t.model,max_tokens:t.model_max_tokens,temperature:t.model_temperature,prompt:t.prompt,consumer_module:"playground"});if(m(!1),a&&r(a),!e)return!1;(e=>{l({prompt:t.prompt?t.prompt+"\n"+e:e})})(e)}catch(e){o(e.message)}},isDisabled:!t.prompt}))},O=()=>{const{Fill:a}=(0,s.useModalSlotContext)(),{playgroundImage:t,setPlaygroundImage:l,setPlaygroundError:o}=i(),{setTransactionsForm:r}=(0,s.useTransactionsFormProvider)(),[c,m]=(0,e.useState)(""),[d,_]=(0,e.useState)(!1),[p,g]=(0,e.useState)(!1),E=t.images.map((e=>e.src));return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(y,null),(0,e.createElement)(a.Content,null,(0,e.createElement)("div",{className:"aicp__modal__flex"},(0,e.createElement)("div",{className:"aicp__modal__flex__column1"},(0,e.createElement)(u.TextareaControl,{key:"image",className:"aicp__playground__modal__textarea",required:!0,label:(0,n.__)("Instructions","ai-copilot"),placeholder:(0,n.__)('Insert your prompt. For example: "A photo of a cat with a hat."',"ai-copilot"),value:t.image_prompt,onChange:e=>(e=>l({image_prompt:e}))(e)})),(0,e.createElement)("div",{className:"aicp__modal__flex__column2"},(0,e.createElement)(s.CarouselImages,{images:E,onChange:m})))),(0,e.createElement)(S,null,(0,e.createElement)(s.ImagePanel,{initialOpen:!0,values:t,onChange:l})),(0,e.createElement)(A,{isLoading:d,handleSubmit:async e=>{e.preventDefault(),_(!0);try{const e=t,{response:a,transaction:s}=await(0,f.fetchServicesImage)({...e,prompt:e.image_prompt,consumer_module:"playground",image_source:e.image_source,image_model:"pexels"===e.image_source?"pexels":"dall-e-3"});if(_(!1),s&&r(s),!a)return;(e=>{l({images:e})})(a)}catch(e){o(e)}},isDisabled:!t.image_prompt},E.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"aicp__playground__modal__image__button-container"},(0,e.createElement)("button",{onClick:async e=>{e.preventDefault();const{caption:a="",base64:s=""}=t.images.find((e=>e.src===c)),n={url:c,caption:a,base64:s,post_id:0};g(!0),await(0,f.fetchRestApiImageUpload)({data:n}),g(!1)},className:"button button-secondary",disabled:p},(0,n.__)("Save to Media Library","ai-copilot")),p&&(0,e.createElement)(s.Spinner,null)))))},I=()=>{const{playgroundTab:t,responseError:s}=i();return(0,e.useEffect)((()=>{s&&(0,a.createNotice)(s)}),[s]),(0,e.createElement)(e.Fragment,null,"completion"===t&&(0,e.createElement)(b,null),"chat"===t&&(0,e.createElement)(N,null),"assistant"===t&&(0,e.createElement)(h,null),"image"===t&&(0,e.createElement)(O,null))},x=()=>{const{isModalOpen:a,setIsModalOpen:t,playgroundTab:n}=i();return(0,e.createElement)(s.Modal,{className:p()("aicp__playground__modal",n),show:a,onClose:()=>t(!1)},(0,e.createElement)(I,null))},M=()=>{const{modifiedSettingsModules:a}=(0,d.useAdminMenuModulesSettings)(),t=a.playground_enable,{isModalOpen:s,setIsModalOpen:n}=i();return(0,e.useEffect)((()=>{if(void 0===t)return;const e=document.querySelector("#wp-admin-bar-wcp_playground_admin_bar_link");return e&&e.addEventListener("click",(e=>{e.preventDefault(),n(!0)})),0===t?(e?.classList.add("hidden"),n(!1)):e.classList.contains("hidden")&&(1===e.classList.length?e.removeAttribute("class"):e.classList.remove("hidden")),()=>{e?.removeEventListener("click",(()=>n(!0)))}}),[t,s]),s?(0,e.createElement)(x,null):null};(0,a.onDocumentLoaded)((()=>{const a=document.getElementById("wpadminbar"),t=document.createElement("div");a.appendChild(t),(0,e.render)((0,e.createElement)(m,null,(0,e.createElement)(s.TransactionsFormProvider,null,(0,e.createElement)(M,null))),t)}))})()})();